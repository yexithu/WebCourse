#微信墙
叶曦  
2014013417  
yexithu14@163.com

##实验背景
利用Websocket和CSS3，实现一个简单的聊天墙。  

##发布地址
本次作业发布在

[https://yexithu.github.io/WebCourse/hw4/](https://yexithu.github.io/WebCourse/hw4/)


##实验要求完成情况
###页面预览
考虑市面上投影仪的分辨率，适配16:9 4:3,

16:9页面预览
![](http://i.imgur.com/dhXmKR2.jpg)
4:3页面预览
![](http://i.imgur.com/cRYcC7e.jpg)

###界面说明
见预览图，在各种长宽比下，微信墙都能  
####正确显示3条消息
####正确显示昵称和头像
####加载动画
加载动画的实现，在为`img`标签设置`src`时，同时增加了`load`事件，`load`事件，在加载前显示loading的图像，在加载完成之后回调，取消loading图像，显示头像。  
实际上在，在更新消息过程中，由于动画做的比较完备，几乎察觉不到loading，在刷新时获取历史信息的过程中，loading过程比较明显，可以短暂观察到loading过程，如下图。
![](http://i.imgur.com/NbW41Lc.png)

####新消息动画
新消息置顶策略，每次来的新消息都会显示在最顶端，而淘汰最末的一个消息，并且消息顺位后移。

####伪公告滚动
在顶部，有滚动的伪公告，在main.js中提供了修改公告的API。

####历史消息的加载与显示
每次刷新页面时，都将获取最近3条消息，并显示，显示有动画效果，会同时刷新3条消息。

####不同屏幕适配
由预览图可知，适配了各种屏幕大小，实际上，本微信墙的CSS均由比例定义能适应更多种屏幕大小和长宽比。

###UI
####字号
使用大字号，方便投影和观看。

####消息长度
支持100长度的消息，消息无法全部显示时，会采取滚动的策略。

####新消息动画
新消息加入和旧消息的删除都有动画效果，流畅，而且采用了在动画过程中加载的策略，缩短了图片加载的时间对用户体验的影响。

###管理员账号
####样式
为了醒目，管理员账号会出现在屏幕最上层，居中显示如下图。

![](http://i.imgur.com/k7x1hOc.jpg)

####时间与刷新
管理员消息持续时间为10s，期间不影响其他消息的滚动，若在管理员持续时间内收到新的管理员消息，则会覆盖。

####动画效果
管理员消息的出现与覆盖都实现了动画效果。

##提高要求
引用了**twemoji**和**weface**，在消息中支持了**emoji**和微信表情,如下
![](http://i.imgur.com/7k8JwOE.jpg)


##代码说明
*root folder*  
**index.html**微信墙网页

*js*    
**backent.js**网络管理模块，包含socket连接和ajax请求API  
**main.js** Manager模块，管理页面刷新，消息绘制  
其他文件--各种库文件

##核心功能实现
###消息刷新动画
在页面中显示3条消息，实际上有4个`div`，有一个`div`非更新消息时  
`width height opacity`都为0，隐藏起来，在消息刷新时，其置于顶部，装入新消息，而最下一个`div`隐藏，成为隐藏消息，使用4个`div`进行循环可实现流畅的动画效果。

###消息刷新时间
消息用消息队列保存，消息刷新有最小缓冲时间，即两次刷新消息时间不超过一定值（实现中2000ms）。

 